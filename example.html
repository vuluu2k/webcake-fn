<!DOCTYPE html>
<html x:id="test-site-123">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Webcake FN - Example</title>
</head>
<body>
  <h1>Webcake FN - Browser Test</h1>
  
  <div>
    <h2>Test API Calls</h2>
    <button onclick="testGetRequest()">Test GET Request</button>
    <button onclick="testPostRequest()">Test POST Request</button>
    <button onclick="testCustomBaseUrl()">Test Custom Base URL</button>
  </div>

  <div id="output" style="margin-top: 20px; padding: 10px; background: #f0f0f0;">
    <h3>Output:</h3>
    <pre id="result"></pre>
  </div>

  <!-- Load as ES Module -->
  <script type="module">
    import api, { FunctionCall } from './dist/webcake-fn.esm.js';
    
    window.api = api;
    window.FunctionCall = FunctionCall;
    
    console.log('Webcake FN loaded successfully!');
    console.log('Available: window.api, window.FunctionCall');
  </script>

  <script>
    function log(message, data) {
      const output = document.getElementById('result');
      output.textContent += `\n${message}\n${JSON.stringify(data, null, 2)}\n`;
      console.log(message, data);
    }

    async function testGetRequest() {
      try {
        log('Testing GET request (returns direct result):', { function: 'get_getUserData' });
        
        // Note: This will fail in real execution because there's no backend
        // But it demonstrates the API usage
        // API proxy returns direct result, not full response
        const result = await window.api.get_getUserData({ 
          userId: '123',
          includeProfile: true
        });
        
        log('GET Success (direct result):', result);
      } catch (error) {
        log('GET Error (Expected - no backend):', error.message);
      }
    }

    async function testPostRequest() {
      try {
        log('Testing POST request (returns direct result):', { function: 'post_createUser' });
        
        // Method prefix must be lowercase
        // Returns direct result
        const result = await window.api.post_createUser({ 
          name: 'John Doe',
          email: 'john@example.com',
          age: 25
        });
        
        log('POST Success (direct result):', result);
      } catch (error) {
        log('POST Error (Expected - no backend):', error.message);
      }
    }

    async function testCustomBaseUrl() {
      try {
        log('Testing custom base URL:', { baseUrl: '/custom/api' });
        
        const fn = new window.FunctionCall({ baseUrl: '/custom/api' });
        
        // callFn returns full response
        const response = await fn.callFn('GET', 'testFunction', { test: 'data' });
        log('Custom URL with callFn (full response):', response);
        
        // callFnResult returns direct result
        const result = await fn.callFnResult('GET', 'testFunction', { test: 'data' });
        log('Custom URL with callFnResult (direct result):', result);
      } catch (error) {
        log('Custom URL Error (Expected - no backend):', error.message);
      }
    }
  </script>
</body>
</html>

